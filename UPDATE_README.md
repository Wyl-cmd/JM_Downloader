# JM下载器自动更新功能说明

## 功能概述

已为 JM下载器添加了自动更新功能，可以自动检测 GitHub 仓库的最新版本并进行更新。

## 新增文件

### updater.py
自动更新模块，包含以下功能：

- **版本检查**：通过 GitHub API 检查最新版本
- **版本比较**：智能比较版本号（支持多级版本号）
- **下载更新**：自动下载最新版本的 .exe 文件
- **安装更新**：备份旧版本并安装新版本
- **自动重启**：更新完成后自动重启程序

## 使用方法

### 1. 检查更新
- 点击主界面的"检查更新"按钮
- 程序会自动连接 GitHub API 检查最新版本
- 如果发现新版本，会显示更新窗口

### 2. 更新流程
1. **发现新版本**：显示新版本号和更新日志
2. **下载更新**：点击"下载更新"按钮，显示下载进度
3. **安装更新**：下载完成后自动安装，备份旧版本
4. **重启程序**：安装完成后点击"重启程序"按钮

### 3. 手动更新
如果自动更新失败，可以手动从 GitHub Releases 下载最新版本：
https://github.com/Wyl-cmd/JM_Downloader/releases

## 技术细节

### GitHub API
- 使用 GitHub REST API 获取最新版本信息
- API 地址：`https://api.github.com/repos/Wyl-cmd/JM_Downloader/releases/latest`
- 自动获取 .exe 文件的下载链接

### 版本号格式
- 当前版本：1.0.0
- 版本号格式：主版本.次版本.修订版本
- 支持多级版本号比较（如 1.0.1 > 1.0.0）

### 安全特性
- **自动备份**：更新前自动备份旧版本为 .bak 文件
- **错误处理**：完善的异常捕获和错误提示
- **网络超时**：检查更新超时时间为 10 秒
- **下载超时**：下载更新超时时间为 30 秒

## 配置说明

### 修改版本号
在 `updater.py` 中修改 `CURRENT_VERSION` 变量：
```python
CURRENT_VERSION = "1.0.0"
```

### 修改 GitHub 仓库
如果需要更改 GitHub 仓库地址，修改 `GITHUB_REPO` 变量：
```python
GITHUB_REPO = "Wyl-cmd/JM_Downloader"
```

## 依赖要求

新增依赖：
- `requests`：用于 HTTP 请求

已在 `requirements.txt` 中添加。

## 打包说明

### 更新依赖
```bash
pip install -r requirements.txt
```

### 打包程序
```bash
pyinstaller main.spec
```

### PyInstaller 配置
已在 `main.spec` 中添加 `requests` 到 `hiddenimports` 列表，确保打包时包含该模块。

## 注意事项

1. **网络连接**：检查更新需要网络连接
2. **GitHub 访问**：确保能访问 GitHub API
3. **防火墙**：某些网络环境可能需要配置防火墙
4. **权限**：更新程序需要管理员权限（用于替换 .exe 文件）
5. **备份**：旧版本会自动备份为 .bak 文件

## 故障排除

### 检查更新失败
- 检查网络连接
- 检查是否能访问 GitHub
- 查看日志文件获取详细错误信息

### 下载更新失败
- 检查网络连接
- 检查磁盘空间
- 尝试手动下载更新

### 安装更新失败
- 检查是否有管理员权限
- 检查程序是否正在运行
- 关闭程序后重试

## 更新日志

### v1.1.0 (2026-01-29)
- 新增：自动更新功能
- 新增：GitHub API 版本检查
- 新增：自动下载和安装更新
- 新增：版本比较算法
- 新增：更新进度显示
- 新增：自动备份旧版本

---

**作者**：K_空想科技
**GitHub**：https://github.com/Wyl-cmd/JM_Downloader
**QQ群**：1154539255
**B站主页**：https://space.bilibili.com/397706571
